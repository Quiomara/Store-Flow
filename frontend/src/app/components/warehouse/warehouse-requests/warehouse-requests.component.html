<div class="warehouse-requests-container" [@fadeIn]>
  <h1 class="text-center font-weight-bold mb-4">Sistema Integrado de Gestión</h1>
  <h2 class="text-center font-weight-bold mb-4">PRÉSTAMO DE HERRAMIENTAS</h2>

  <!-- Agrupamos todos los filtros en un solo formulario -->
  <form [formGroup]="searchForm" class="search-form" style="display: flex; flex-wrap: wrap; align-items: center; gap: 10px;">
    <!-- Input ID -->
    <mat-form-field appearance="fill">
      <mat-label>ID del Préstamo</mat-label>
      <input matInput type="text" formControlName="searchId" placeholder="ID del Préstamo">
    </mat-form-field>

    <!-- Input Nombre del Instructor -->
    <mat-form-field appearance="fill">
      <mat-label>Nombre del Instructor</mat-label>
      <input matInput type="text" formControlName="searchInstructor" placeholder="Nombre del Instructor">
    </mat-form-field>

    <!-- Date-picker para la fecha -->
    <mat-form-field appearance="fill">
      <mat-label>Fecha</mat-label>
      <input matInput [matDatepicker]="picker" formControlName="searchFecha" placeholder="Fecha">
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <!-- Select para el estado -->
    <mat-form-field appearance="fill">
      <mat-label>Estado</mat-label>
      <mat-select formControlName="searchEstado" (selectionChange)="seleccionarEstado($event)">
        <mat-option value="">Todos los estados</mat-option>
        <mat-option *ngFor="let estado of estados" [value]="estado.est_nombre">
          {{ estado.est_nombre }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </form>

  <div class="user-table-container" [@fadeIn]>
    <!-- Spinner de carga -->
    <div *ngIf="isLoading" class="spinner-container text-center">
      <mat-spinner></mat-spinner>
    </div>

    <!-- Tabla de Préstamos -->
    <table mat-table [dataSource]="filteredPrestamos" class="mat-elevation-z8 table" *ngIf="!isLoading">
      <!-- Columna: ID del Préstamo -->
      <ng-container matColumnDef="idPrestamo">
        <th mat-header-cell *matHeaderCellDef class="header-cell">ID del Préstamo</th>
        <td mat-cell *matCellDef="let prestamo">{{ prestamo.idPrestamo }}</td>
      </ng-container>

      <!-- Columna: Fecha Inicio -->
      <ng-container matColumnDef="fechaHora">
        <th mat-header-cell *matHeaderCellDef class="header-cell">Fecha Inicio</th>
        <td mat-cell *matCellDef="let prestamo">{{ prestamo.fechaHora }}</td>
      </ng-container>

      <!-- Columna: Instructor -->
      <ng-container matColumnDef="instructorNombre">
        <th mat-header-cell *matHeaderCellDef class="header-cell">Instructor</th>
        <td mat-cell *matCellDef="let prestamo">{{ prestamo.instructorNombre }}</td>
      </ng-container>

      <!-- Columna: Estado -->
      <ng-container matColumnDef="estado">
        <th mat-header-cell *matHeaderCellDef class="header-cell">Estado</th>
        <td mat-cell *matCellDef="let prestamo">
          <span class="estado-badge" [ngClass]="getEstadoClass(prestamo.estado)">
            {{ prestamo.estado }}
          </span>
        </td>
      </ng-container>

      <!-- Columna: Detalles -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef class="header-cell acciones-header">Detalles</th>
        <td mat-cell *matCellDef="let prestamo">
          <button mat-icon-button (click)="verDetalles(prestamo)" class="icon-btn">
            <mat-icon>visibility</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- Filas de la tabla -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns" sticky></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <!-- Mensaje cuando no hay resultados -->
    <div *ngIf="filteredPrestamos.data.length === 0 && !isLoading" class="no-results text-center">
      {{ mensajeNoPrestamos }}
    </div>
  </div>

  <!-- Paginador -->
  <mat-paginator [length]="filteredPrestamos.data.length" [pageSize]="10" [pageSizeOptions]="[5, 10, 25, 100]"
    aria-label="Seleccionar página">
  </mat-paginator>
</div>
